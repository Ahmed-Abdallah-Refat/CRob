<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="stylesheet" href="main.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>

    <title><%=botName%> | Stats</title>
</head>
<body>
    <div class="header">
        <h1>Statistics</h1>
        <h3>this is an <a href="https://github.com/tascord/cRob">open source</a> bot</h3>
        
        <div class="navBar">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/login">Login</a></li>
                <li><a href="/stats" class="active">Stats</a></li>
                <li><a href="/about">About</a></li>
            </ul>
        </div>
    </div>

    <div class="stats">
        <canvas id="stats"></canvas>
        <input type="range" id="time" min="2" max="500" value="90" class="slider">
    </div>
    
    <script>

        var statsCtx = document.getElementById('stats').getContext('2d');

        var times = [];
        var pingData = [];
        var guildData = [];

        var slidertime;

        var stats = new Chart(statsCtx, {
            type: 'line',
            data: {
                labels: times,
                datasets: [{
                    label: 'Ping to API',
                    backgroundColor: 'rgba(132, 159, 255, 0.15)',
                    borderColor: 'rgb(114, 137, 218)',
                    data: pingData
                }, {
                    label: "Server Count",
                    backgroundColor: 'rgba(167, 132, 255, 0.15)',
                    borderColor: 'rgb(142, 112, 216)',
                    data: guildData
                }],
            },
            options: {
                title: {
                    display: true,
                }
            }
        })
        
        document.getElementById('time').addEventListener('input', update);
        update();
        
        function update() {
            
            var sliderValue = document.getElementById('time').value;
            
            times = "<%=times%>".split(",");
            pingData = "<%=pingData%>".split(",");
            guildData = "<%=guildData%>".split(",");
            
            document.getElementById('time').max = times.length;
            
            while (times.length > sliderValue) {
                times.shift();
                pingData.shift();
                guildData.shift();
            }

            stats.data.datasets.forEach((dataset) => {
                if(dataset.label == "Ping to API") dataset.data = pingData;
                if(dataset.label == "Server Count") dataset.data = guildData;
            });

            stats.data.labels = times;

            stats.options.title.text = `Showing ${sliderValue} nodes.`;

            stats.chart.update();

    }

    </script>

</body>
</html>